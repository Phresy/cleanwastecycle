<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Nearby Collectors</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-800">
  <div class="max-w-4xl mx-auto p-6">
    <h1 class="text-3xl font-bold mb-4">Nearby Collectors</h1>
    <p class="mb-4">Fetching your location...</p>

    <div id="userLocation" class="mb-6 p-4 bg-white rounded shadow"></div>

    <div class="grid md:grid-cols-2 gap-6" id="collectorsList">
      <!-- Nearby collectors will appear here -->
    </div>
  </div>

  <script>
    // Dummy collector data (replace with backend/API later)
    const collectors = [
      { name: "Collector 1", lat: 5.6037, lon: -0.1870 }, // Accra
      { name: "Collector 2", lat: 5.5600, lon: -0.2050 }, // Accra suburb
      { name: "Collector 3", lat: 6.6740, lon: -1.5710 }, // Kumasi (farther away)
    ];

    // Function to calculate distance between coordinates (Haversine)
    function getDistance(lat1, lon1, lat2, lon2) {
      const R = 6371;
      const dLat = (lat2 - lat1) * Math.PI / 180;
      const dLon = (lon2 - lon1) * Math.PI / 180;
      const a =
        Math.sin(dLat / 2) ** 2 +
        Math.cos(lat1 * Math.PI / 180) *
        Math.cos(lat2 * Math.PI / 180) *
        Math.sin(dLon / 2) ** 2;
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      return (R * c).toFixed(2); // in KM
    }

    // Fetch user's location
    navigator.geolocation.getCurrentPosition(
      (position) => {
        const { latitude, longitude } = position.coords;
        document.getElementById("userLocation").innerHTML = `
          <strong>Your Location:</strong> Lat: ${latitude.toFixed(4)}, Lon: ${longitude.toFixed(4)}
        `;

        const list = document.getElementById("collectorsList");
        collectors.forEach(collector => {
          const distance = getDistance(latitude, longitude, collector.lat, collector.lon);
          const div = document.createElement("div");
          div.className = "bg-white p-4 rounded shadow";
          div.innerHTML = `
            <h2 class="text-xl font-semibold">${collector.name}</h2>
            <p>Distance: <strong>${distance} km</strong></p>
            <button class="mt-2 px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">Request Pickup</button>
          `;
          list.appendChild(div);
        });
      },
      (error) => {
        document.getElementById("userLocation").innerText = "Error getting location. Please allow access.";
      }
    );
  </script>
</body>
</html>
